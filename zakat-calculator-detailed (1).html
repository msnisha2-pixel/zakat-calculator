<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zakat Calculator - Salafi Methodology</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap');
        
        :root {
            --primary: #1a5f4f;
            --primary-light: #2d8a72;
            --primary-dark: #0f3d2f;
            --accent: #d4a574;
            --bg-main: #f8f6f3;
            --bg-card: #ffffff;
            --text-primary: #1a2b24;
            --text-secondary: #5a6d64;
            --border: #e0ddd7;
            --success: #2d8a72;
            --danger: #c44536;
            --shadow: rgba(26, 95, 79, 0.08);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background: linear-gradient(135deg, #f8f6f3 0%, #ebe8e3 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow);
            border-top: 4px solid var(--primary);
        }
        
        .header h1 {
            font-family: 'Amiri', serif;
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .header .arabic {
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 1rem;
            font-family: 'Amiri', serif;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 1rem;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2rem;
            align-items: start;
        }
        
        .form-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px var(--shadow);
        }
        
        .summary-panel {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 16px;
            padding: 2rem;
            color: white;
            position: sticky;
            top: 2rem;
            box-shadow: 0 8px 30px rgba(26, 95, 79, 0.3);
        }
        
        .section-title {
            font-family: 'Amiri', serif;
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .section-icon {
            font-size: 1.3rem;
        }
        
        .collapsible-section {
            margin-bottom: 1.5rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .collapsible-section:hover {
            border-color: var(--primary-light);
        }
        
        .collapsible-header {
            background: linear-gradient(135deg, #fef8f0 0%, #fef4e8 100%);
            padding: 1rem 1.25rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            transition: all 0.2s;
        }
        
        .collapsible-header:hover {
            background: linear-gradient(135deg, #fef4e8 0%, #feefd8 100%);
        }
        
        .collapsible-header h3 {
            font-size: 1.1rem;
            color: var(--primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .collapse-icon {
            font-size: 1.2rem;
            color: var(--accent);
            transition: transform 0.3s;
        }
        
        .collapsible-section.active .collapse-icon {
            transform: rotate(180deg);
        }
        
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0 1.25rem;
        }
        
        .collapsible-section.active .collapsible-content {
            max-height: 2000px;
            padding: 1.25rem;
        }
        
        .sub-category {
            background: #f9faf9;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 3px solid var(--accent);
        }
        
        .sub-category-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .currency-select {
            margin-bottom: 2rem;
        }
        
        .currency-select label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .currency-select select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .currency-select select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .nisab-display {
            background: linear-gradient(135deg, #fef8f0 0%, #fef4e8 100%);
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--accent);
        }
        
        .nisab-display h4 {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .nisab-values {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .nisab-value {
            display: flex;
            flex-direction: column;
        }
        
        .nisab-value label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }
        
        .nisab-value .amount {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .input-group {
            margin-bottom: 1rem;
        }
        
        .input-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.95rem;
        }
        
        .info-btn {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 0.7rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .info-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }
        
        .input-wrapper {
            position: relative;
        }
        
        .input-wrapper input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.2s;
            background: white;
        }
        
        .input-wrapper input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 79, 0.1);
        }
        
        .input-helper {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
            font-style: italic;
        }
        
        .debts-section {
            margin-top: 2rem;
        }
        
        .debts-section .section-title {
            color: var(--danger);
            border-bottom-color: rgba(196, 69, 54, 0.2);
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.875rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-item label {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .summary-item .value {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .net-assets {
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .zakat-amount {
            background: rgba(255, 255, 255, 0.2);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            margin-top: 1.5rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .zakat-amount h3 {
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .zakat-amount .amount {
            font-family: 'Amiri', serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .zakat-amount .percentage {
            font-size: 0.875rem;
            opacity: 0.8;
        }
        
        .threshold-warning {
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
        }
        
        .threshold-warning.below {
            background: rgba(255, 200, 100, 0.2);
        }
        
        .threshold-warning.above {
            background: rgba(100, 255, 150, 0.2);
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .btn {
            padding: 0.875rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .btn-primary:hover {
            background: rgba(255, 255, 255, 0.35);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            backdrop-filter: blur(4px);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }
        
        .modal-header h3 {
            font-family: 'Amiri', serif;
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .close-btn:hover {
            background: var(--border);
            color: var(--text-primary);
        }
        
        .modal-body {
            color: var(--text-primary);
            line-height: 1.8;
        }
        
        .modal-body h4 {
            color: var(--primary);
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        
        .modal-body p {
            margin-bottom: 1rem;
        }
        
        .modal-body ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .modal-body li {
            margin-bottom: 0.5rem;
        }
        
        .daleel {
            background: #fef8f0;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            margin: 1rem 0;
            font-style: italic;
        }
        
        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-panel {
                position: relative;
                top: 0;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header .arabic {
                font-size: 1.5rem;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        .footnote {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--border);
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .footnote h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .category-total {
            background: #e8f5f1;
            padding: 0.75rem;
            border-radius: 6px;
            margin-top: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Zakat Calculator</h1>
            <div class="arabic">ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿ≤ŸÉÿßÿ©</div>
            <p>Calculate your Zakat obligation according to Salafi methodology based on the Quran, Sunnah, and understanding of the Salaf as-Salih</p>
        </div>
        
        <div class="main-grid">
            <div class="form-section">
                <div class="currency-select">
                    <label for="currency">Select Currency</label>
                    <select id="currency">
                        <option value="USD">üá∫üá∏ US Dollar (USD)</option>
                        <option value="SAR">üá∏üá¶ Saudi Riyal (SAR)</option>
                        <option value="EUR">üá™üá∫ Euro (EUR)</option>
                        <option value="GBP">üá¨üáß British Pound (GBP)</option>
                        <option value="AED">üá¶üá™ UAE Dirham (AED)</option>
                        <option value="EGP">üá™üá¨ Egyptian Pound (EGP)</option>
                        <option value="PKR">üáµüá∞ Pakistani Rupee (PKR)</option>
                        <option value="INR">üáÆüá≥ Indian Rupee (INR)</option>
                        <option value="MYR">üá≤üáæ Malaysian Ringgit (MYR)</option>
                        <option value="NZD">üá≥üáø New Zealand Dollar (NZD)</option>
                    </select>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span id="dataStatus">üîÑ Loading live rates...</span>
                        <button onclick="refreshRates()" style="padding: 0.25rem 0.5rem; font-size: 0.7rem; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 0.5rem;">Refresh</button>
                        <span id="lastUpdate" style="margin-left: auto;"></span>
                    </div>
                </div>
                
                <div class="nisab-display">
                    <h4>Nisab Threshold (ÿßŸÑŸÜÿµÿßÿ®)</h4>
                    <div class="nisab-values">
                        <div class="nisab-value">
                            <label>Gold (85g)</label>
                            <div class="amount" id="goldNisab">$0.00</div>
                        </div>
                        <div class="nisab-value">
                            <label>Silver (595g)</label>
                            <div class="amount" id="silverNisab">$0.00</div>
                        </div>
                    </div>
                </div>
                
                <!-- PRECIOUS METALS SECTION -->
                <div class="collapsible-section active">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h3><span>üíé</span> Precious Metals (Gold & Silver)</h3>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="sub-category">
                            <div class="sub-category-title">ü•á Gold</div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Gold Jewelry (grams)</span>
                                    <button class="info-btn" onclick="showModal('goldJewelry')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="goldJewelry" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Necklaces, bracelets, rings worn regularly</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Gold Coins & Bars (grams)</span>
                                    <button class="info-btn" onclick="showModal('goldBars')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="goldBars" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Investment gold, stored gold bullion</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Other Gold Items (grams)</span>
                                    <button class="info-btn" onclick="showModal('goldOther')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="goldOther" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Gold ornaments, antiques, heirlooms</div>
                                </div>
                            </div>
                            
                            <div class="category-total">
                                <span>Total Gold:</span>
                                <span id="totalGold">0.00 g</span>
                            </div>
                        </div>
                        
                        <div class="sub-category">
                            <div class="sub-category-title">ü•à Silver</div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Silver Jewelry (grams)</span>
                                    <button class="info-btn" onclick="showModal('silverJewelry')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="silverJewelry" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Silver rings, bracelets, anklets</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Silver Coins & Bars (grams)</span>
                                    <button class="info-btn" onclick="showModal('silverBars')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="silverBars" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Investment silver, bullion</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Silver Utensils & Items (grams)</span>
                                    <button class="info-btn" onclick="showModal('silverUtensils')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="silverUtensils" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Plates, cups, decorative items</div>
                                </div>
                            </div>
                            
                            <div class="category-total">
                                <span>Total Silver:</span>
                                <span id="totalSilver">0.00 g</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- CASH & BANK ACCOUNTS SECTION -->
                <div class="collapsible-section active">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h3><span>üíµ</span> Cash & Bank Accounts</h3>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="input-group">
                            <div class="input-label">
                                <span>Physical Cash at Home</span>
                                <button class="info-btn" onclick="showModal('cashHome')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="cashHome" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Cash in wallet, safe, or home</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Checking Account(s)</span>
                                <button class="info-btn" onclick="showModal('checking')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="checking" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Current/transactional accounts</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Savings Account(s)</span>
                                <button class="info-btn" onclick="showModal('savings')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="savings" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">All savings accounts combined</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Fixed Deposits / CDs</span>
                                <button class="info-btn" onclick="showModal('fixedDeposits')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="fixedDeposits" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Term deposits, certificates of deposit</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Money Market Accounts</span>
                                <button class="info-btn" onclick="showModal('moneyMarket')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="moneyMarket" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">High-yield savings or money market</div>
                            </div>
                        </div>
                        
                        <div class="category-total">
                            <span>Total Cash:</span>
                            <span id="totalCash">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- BUSINESS ASSETS SECTION -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h3><span>üè¢</span> Business Assets</h3>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="input-group">
                            <div class="input-label">
                                <span>Inventory for Resale</span>
                                <button class="info-btn" onclick="showModal('inventory')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="inventory" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Finished goods ready to sell</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Raw Materials</span>
                                <button class="info-btn" onclick="showModal('rawMaterials')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="rawMaterials" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Materials for manufacturing</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Work in Progress</span>
                                <button class="info-btn" onclick="showModal('workInProgress')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="workInProgress" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Partially completed products</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Accounts Receivable (Strong)</span>
                                <button class="info-btn" onclick="showModal('receivables')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="receivables" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Money owed by reliable customers</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Business Cash Reserves</span>
                                <button class="info-btn" onclick="showModal('businessCash')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="businessCash" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Cash in business accounts</div>
                            </div>
                        </div>
                        
                        <div class="category-total">
                            <span>Total Business Assets:</span>
                            <span id="totalBusiness">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- INVESTMENTS SECTION -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h3><span>üìà</span> Investments & Securities</h3>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="input-group">
                            <div class="input-label">
                                <span>Individual Stocks (Current Value)</span>
                                <button class="info-btn" onclick="showModal('stocks')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="stocks" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Shares in halal companies</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Mutual Funds / ETFs</span>
                                <button class="info-btn" onclick="showModal('mutualFunds')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="mutualFunds" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Index funds, mutual funds, ETFs</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Sukuk / Islamic Bonds</span>
                                <button class="info-btn" onclick="showModal('sukuk')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="sukuk" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Sharia-compliant investment certificates</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>REITs (Real Estate Investment Trusts)</span>
                                <button class="info-btn" onclick="showModal('reits')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="reits" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Halal real estate investment trusts</div>
                            </div>
                        </div>
                        
                        <div class="category-total">
                            <span>Total Investments:</span>
                            <span id="totalInvestments">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- CRYPTOCURRENCY SECTION -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h3><span>‚Çø</span> Cryptocurrency</h3>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="input-group">
                            <div class="input-label">
                                <span>Bitcoin (Current Value)</span>
                                <button class="info-btn" onclick="showModal('bitcoin')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="bitcoin" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">BTC holdings</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Ethereum</span>
                                <button class="info-btn" onclick="showModal('ethereum')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="ethereum" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">ETH holdings</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Stablecoins (USDT, USDC, etc.)</span>
                                <button class="info-btn" onclick="showModal('stablecoins')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="stablecoins" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Dollar-pegged cryptocurrencies</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Other Cryptocurrencies</span>
                                <button class="info-btn" onclick="showModal('otherCrypto')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="otherCrypto" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Altcoins, other tokens</div>
                            </div>
                        </div>
                        
                        <div class="category-total">
                            <span>Total Cryptocurrency:</span>
                            <span id="totalCrypto">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- RECEIVABLES & LOANS SECTION -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h3><span>üí≥</span> Money Owed to You</h3>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="input-group">
                            <div class="input-label">
                                <span>Personal Loans Given (Strong Debt)</span>
                                <button class="info-btn" onclick="showModal('loansGiven')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="loansGiven" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Money lent to reliable people who will repay</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Salary/Wages Owed to You</span>
                                <button class="info-btn" onclick="showModal('wagesOwed')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="wagesOwed" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Unpaid salary from reliable employer</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Security Deposits (Recoverable)</span>
                                <button class="info-btn" onclick="showModal('deposits')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="deposits" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Rental deposits you will get back</div>
                            </div>
                        </div>
                        
                        <div class="category-total">
                            <span>Total Receivables:</span>
                            <span id="totalReceivables">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- RETIREMENT & PENSION SECTION -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h3><span>üè¶</span> Retirement & Pension Funds</h3>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="input-group">
                            <div class="input-label">
                                <span>401(k) / IRA (Accessible)</span>
                                <button class="info-btn" onclick="showModal('retirement401k')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="retirement401k" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Retirement accounts you can access</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Pension Fund (Vested)</span>
                                <button class="info-btn" onclick="showModal('pension')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="pension" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Vested pension benefits</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Provident Fund</span>
                                <button class="info-btn" onclick="showModal('providentFund')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="providentFund" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">EPF, CPF, or similar</div>
                            </div>
                        </div>
                        
                        <div class="category-total">
                            <span>Total Retirement Funds:</span>
                            <span id="totalRetirement">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- RENTAL INCOME SECTION -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h3><span>üèòÔ∏è</span> Rental Income & Property</h3>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="input-group">
                            <div class="input-label">
                                <span>Rental Income Saved (This Year)</span>
                                <button class="info-btn" onclick="showModal('rentalIncome')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="rentalIncome" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Saved rental income from properties</div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-label">
                                <span>Investment Property Profits (Saved)</span>
                                <button class="info-btn" onclick="showModal('propertyProfits')">i</button>
                            </div>
                            <div class="input-wrapper">
                                <input type="number" id="propertyProfits" class="calc-input" placeholder="0" step="0.01" min="0">
                                <div class="input-helper">Saved profits from property sales</div>
                            </div>
                        </div>
                        
                        <div class="category-total">
                            <span>Total from Property:</span>
                            <span id="totalProperty">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- DEBTS SECTION -->
                <div class="debts-section">
                    <div class="section-title">
                        <span class="section-icon">üìã</span>
                        <span>Deductible Debts & Obligations</span>
                    </div>
                    
                    <div class="collapsible-section active">
                        <div class="collapsible-header" onclick="toggleSection(this)">
                            <h3><span>üí∞</span> Immediate Debts</h3>
                            <span class="collapse-icon">‚ñº</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Personal Loans (Due Now)</span>
                                    <button class="info-btn" onclick="showModal('personalLoans')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="personalLoans" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Loans that must be repaid immediately</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Credit Card Balance (Current)</span>
                                    <button class="info-btn" onclick="showModal('creditCard')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="creditCard" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Current statement balance</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Business Debts (Due Immediately)</span>
                                    <button class="info-btn" onclick="showModal('businessDebt')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="businessDebt" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Supplier payments, business loans due</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Borrowed Money from Family/Friends</span>
                                    <button class="info-btn" onclick="showModal('familyDebt')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="familyDebt" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Money you owe to people</div>
                                </div>
                            </div>
                            
                            <div class="category-total">
                                <span>Total Immediate Debts:</span>
                                <span id="totalImmediateDebts">$0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="collapsible-section">
                        <div class="collapsible-header" onclick="toggleSection(this)">
                            <h3><span>üßæ</span> Bills & Obligations</h3>
                            <span class="collapse-icon">‚ñº</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Unpaid Utility Bills</span>
                                    <button class="info-btn" onclick="showModal('utilities')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="utilities" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Overdue electricity, water, gas</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Unpaid Rent (Current Month)</span>
                                    <button class="info-btn" onclick="showModal('rentOwed')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="rentOwed" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Rent due for this month only</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Taxes Due</span>
                                    <button class="info-btn" onclick="showModal('taxesOwed')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="taxesOwed" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Income tax, property tax currently due</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Medical Bills (Unpaid)</span>
                                    <button class="info-btn" onclick="showModal('medical')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="medical" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Outstanding medical expenses</div>
                                </div>
                            </div>
                            
                            <div class="category-total">
                                <span>Total Bills:</span>
                                <span id="totalBills">$0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="collapsible-section">
                        <div class="collapsible-header" onclick="toggleSection(this)">
                            <h3><span>üë•</span> Wages & Obligations to Others</h3>
                            <span class="collapse-icon">‚ñº</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Wages Owed to Employees</span>
                                    <button class="info-btn" onclick="showModal('employeeWages')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="employeeWages" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Unpaid salaries to workers</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Zakat from Previous Years (Unpaid)</span>
                                    <button class="info-btn" onclick="showModal('zakatOwed')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="zakatOwed" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Outstanding zakat obligations</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="input-label">
                                    <span>Kaffarah / Fidyah Owed</span>
                                    <button class="info-btn" onclick="showModal('kaffarah')">i</button>
                                </div>
                                <div class="input-wrapper">
                                    <input type="number" id="kaffarah" class="calc-input" placeholder="0" step="0.01" min="0">
                                    <div class="input-helper">Religious obligations owed</div>
                                </div>
                            </div>
                            
                            <div class="category-total">
                                <span>Total Obligations:</span>
                                <span id="totalObligations">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="footnote">
                    <h4>Important Notes:</h4>
                    <p><strong>Long-term debts (mortgages, car loans):</strong> There is scholarly difference regarding their deduction. The stronger opinion according to many Salafi scholars is that they are NOT deductible from zakatable wealth, as zakat is due on the current wealth you possess, not on future obligations. Only deduct immediate debts that are currently due.</p>
                    <p><strong>Nisab calculation:</strong> The majority of contemporary Salafi scholars recommend using the silver nisab as it ensures more wealth is distributed to the poor, which better fulfills the maqasid (objectives) of zakat.</p>
                    <p><strong>Hawl (one lunar year):</strong> Ensure your wealth has been in your possession for one complete lunar year (354 days) before calculating zakat. If your wealth fluctuates, calculate based on what remains after one year.</p>
                    <p><strong>Real-time data:</strong> This calculator uses live market data for gold/silver prices and currency exchange rates. Rates are updated automatically every 5 minutes. For the most accurate calculation, use the "Refresh" button before finalizing your zakat amount.</p>
                </div>
            </div>
            
            <div class="summary-panel">
                <h3 style="margin-bottom: 1.5rem; font-family: 'Amiri', serif; font-size: 1.5rem;">Zakat Summary</h3>
                
                <div class="summary-item">
                    <label>Total Assets</label>
                    <div class="value" id="totalAssets">$0.00</div>
                </div>
                
                <div class="summary-item">
                    <label>Total Debts</label>
                    <div class="value" id="totalDebts">$0.00</div>
                </div>
                
                <div class="summary-item net-assets">
                    <label style="font-size: 1.1rem; font-weight: 600;">Net Zakatable Assets</label>
                    <div class="value" style="font-size: 1.3rem;" id="netAssets">$0.00</div>
                </div>
                
                <div class="zakat-amount">
                    <h3>Your Zakat Due</h3>
                    <div class="amount" id="zakatAmount">$0.00</div>
                    <div class="percentage">2.5% of net assets</div>
                </div>
                
                <div class="threshold-warning" id="thresholdWarning">
                    <span>‚ÑπÔ∏è</span>
                    <span id="thresholdText">Enter your assets to calculate zakat</span>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="exportToPDF()">
                        üìÑ Export PDF
                    </button>
                    <button class="btn btn-secondary" onclick="resetForm()">
                        üîÑ Reset
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal -->
    <div class="modal" id="infoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Information</h3>
                <button type="button" class="close-btn" onclick="closeModal()" aria-label="Close information">√ó</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>
    
    <script>
        // Global variables for rates
        let exchangeRates = {
            USD: 1, SAR: 3.75, EUR: 0.92, GBP: 0.79, AED: 3.67,
            EGP: 30.90, PKR: 278.50, INR: 83.12, MYR: 4.72, NZD: 1.67
        };
        
        let goldPricePerGram = 75.50;
        let silverPricePerGram = 0.90;
        let lastUpdateTime = null;
        
        // Fetch real-time exchange rates
        async function fetchExchangeRates() {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                
                if (data && data.rates) {
                    exchangeRates = {
                        USD: 1,
                        SAR: data.rates.SAR || 3.75,
                        EUR: data.rates.EUR || 0.92,
                        GBP: data.rates.GBP || 0.79,
                        AED: data.rates.AED || 3.67,
                        EGP: data.rates.EGP || 30.90,
                        PKR: data.rates.PKR || 278.50,
                        INR: data.rates.INR || 83.12,
                        MYR: data.rates.MYR || 4.72,
                        NZD: data.rates.NZD || 1.67
                    };
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error fetching exchange rates:', error);
                return false;
            }
        }
        
        // Fetch real-time metal prices
        async function fetchMetalPrices() {
            try {
                const response = await fetch('https://api.metals.live/v1/spot');
                const data = await response.json();
                
                if (data && data.length > 0) {
                    const goldData = data.find(item => item.metal === 'gold');
                    const silverData = data.find(item => item.metal === 'silver');
                    
                    if (goldData && goldData.price) {
                        goldPricePerGram = goldData.price / 31.1035;
                    }
                    
                    if (silverData && silverData.price) {
                        silverPricePerGram = silverData.price / 31.1035;
                    }
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error fetching metal prices:', error);
                return await fetchMetalPricesFallback();
            }
        }
        
        async function fetchMetalPricesFallback() {
            try {
                const goldResponse = await fetch('https://api.gold-api.com/price/XAU');
                const silverResponse = await fetch('https://api.gold-api.com/price/XAG');
                
                const goldData = await goldResponse.json();
                const silverData = await silverResponse.json();
                
                if (goldData && goldData.price) {
                    goldPricePerGram = goldData.price / 31.1035;
                }
                
                if (silverData && silverData.price) {
                    silverPricePerGram = silverData.price / 31.1035;
                }
                
                return true;
            } catch (error) {
                console.error('Error with fallback API:', error);
                goldPricePerGram = 75.50;
                silverPricePerGram = 0.90;
                return false;
            }
        }
        
        function updateStatus(success) {
            const statusEl = document.getElementById('dataStatus');
            const updateEl = document.getElementById('lastUpdate');
            
            if (success) {
                statusEl.innerHTML = '‚úÖ Live rates active';
                statusEl.style.color = 'var(--success)';
                lastUpdateTime = new Date();
                updateEl.textContent = 'Updated: ' + lastUpdateTime.toLocaleTimeString();
            } else {
                statusEl.innerHTML = '‚ö†Ô∏è Using cached rates';
                statusEl.style.color = 'var(--accent)';
                updateEl.textContent = 'Live data unavailable';
            }
        }
        
        async function initializeData() {
            const statusEl = document.getElementById('dataStatus');
            statusEl.innerHTML = 'üîÑ Loading live rates...';
            
            const [ratesSuccess, metalsSuccess] = await Promise.all([
                fetchExchangeRates(),
                fetchMetalPrices()
            ]);
            
            const overallSuccess = ratesSuccess && metalsSuccess;
            updateStatus(overallSuccess);
            
            updateNisab();
            
            setInterval(async () => {
                await fetchExchangeRates();
                await fetchMetalPrices();
                updateNisab();
                lastUpdateTime = new Date();
                document.getElementById('lastUpdate').textContent = 'Updated: ' + lastUpdateTime.toLocaleTimeString();
            }, 300000);
        }
        
        async function refreshRates() {
            const statusEl = document.getElementById('dataStatus');
            statusEl.innerHTML = 'üîÑ Refreshing...';
            
            const [ratesSuccess, metalsSuccess] = await Promise.all([
                fetchExchangeRates(),
                fetchMetalPrices()
            ]);
            
            const overallSuccess = ratesSuccess && metalsSuccess;
            updateStatus(overallSuccess);
            updateNisab();
        }
        
        function toggleSection(header) {
            const section = header.parentElement;
            section.classList.toggle('active');
        }
        
        function updateNisab() {
            const currency = document.getElementById('currency').value;
            const rate = exchangeRates[currency];
            
            const goldNisab = (85 * goldPricePerGram * rate).toFixed(2);
            const silverNisab = (595 * silverPricePerGram * rate).toFixed(2);
            
            document.getElementById('goldNisab').textContent = formatCurrency(goldNisab, currency);
            document.getElementById('silverNisab').textContent = formatCurrency(silverNisab, currency);
            
            calculateZakat();
        }
        
        function formatCurrency(amount, currency) {
            const symbols = {
                USD: '$', SAR: 'SAR ', EUR: '‚Ç¨', GBP: '¬£', AED: 'AED ',
                EGP: 'EGP ', PKR: 'PKR ', INR: '‚Çπ', MYR: 'RM ', NZD: 'NZ$'
            };
            return symbols[currency] + parseFloat(amount).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }
        
        function getInputValue(id) {
            return parseFloat(document.getElementById(id)?.value) || 0;
        }
        
        function updateCategoryTotals() {
            const currency = document.getElementById('currency').value;
            const rate = exchangeRates[currency];
            
            // Gold total in grams
            const goldTotal = getInputValue('goldJewelry') + getInputValue('goldBars') + getInputValue('goldOther');
            document.getElementById('totalGold').textContent = goldTotal.toFixed(2) + ' g';
            
            // Silver total in grams
            const silverTotal = getInputValue('silverJewelry') + getInputValue('silverBars') + getInputValue('silverUtensils');
            document.getElementById('totalSilver').textContent = silverTotal.toFixed(2) + ' g';
            
            // Cash total
            const cashTotal = getInputValue('cashHome') + getInputValue('checking') + getInputValue('savings') + 
                             getInputValue('fixedDeposits') + getInputValue('moneyMarket');
            document.getElementById('totalCash').textContent = formatCurrency(cashTotal, currency);
            
            // Business total
            const businessTotal = getInputValue('inventory') + getInputValue('rawMaterials') + 
                                 getInputValue('workInProgress') + getInputValue('receivables') + 
                                 getInputValue('businessCash');
            document.getElementById('totalBusiness').textContent = formatCurrency(businessTotal, currency);
            
            // Investments total
            const investmentsTotal = getInputValue('stocks') + getInputValue('mutualFunds') + 
                                    getInputValue('sukuk') + getInputValue('reits');
            document.getElementById('totalInvestments').textContent = formatCurrency(investmentsTotal, currency);
            
            // Crypto total
            const cryptoTotal = getInputValue('bitcoin') + getInputValue('ethereum') + 
                               getInputValue('stablecoins') + getInputValue('otherCrypto');
            document.getElementById('totalCrypto').textContent = formatCurrency(cryptoTotal, currency);
            
            // Receivables total
            const receivablesTotal = getInputValue('loansGiven') + getInputValue('wagesOwed') + 
                                    getInputValue('deposits');
            document.getElementById('totalReceivables').textContent = formatCurrency(receivablesTotal, currency);
            
            // Retirement total
            const retirementTotal = getInputValue('retirement401k') + getInputValue('pension') + 
                                   getInputValue('providentFund');
            document.getElementById('totalRetirement').textContent = formatCurrency(retirementTotal, currency);
            
            // Property total
            const propertyTotal = getInputValue('rentalIncome') + getInputValue('propertyProfits');
            document.getElementById('totalProperty').textContent = formatCurrency(propertyTotal, currency);
            
            // Debt totals
            const immediateDebts = getInputValue('personalLoans') + getInputValue('creditCard') + 
                                  getInputValue('businessDebt') + getInputValue('familyDebt');
            document.getElementById('totalImmediateDebts').textContent = formatCurrency(immediateDebts, currency);
            
            const billsTotal = getInputValue('utilities') + getInputValue('rentOwed') + 
                              getInputValue('taxesOwed') + getInputValue('medical');
            document.getElementById('totalBills').textContent = formatCurrency(billsTotal, currency);
            
            const obligationsTotal = getInputValue('employeeWages') + getInputValue('zakatOwed') + 
                                    getInputValue('kaffarah');
            document.getElementById('totalObligations').textContent = formatCurrency(obligationsTotal, currency);
        }
        
        function calculateZakat() {
            const currency = document.getElementById('currency').value;
            const rate = exchangeRates[currency];
            
            // Update category totals first
            updateCategoryTotals();
            
            // Get gold and silver values
            const goldGrams = getInputValue('goldJewelry') + getInputValue('goldBars') + getInputValue('goldOther');
            const silverGrams = getInputValue('silverJewelry') + getInputValue('silverBars') + getInputValue('silverUtensils');
            const goldValue = goldGrams * goldPricePerGram * rate;
            const silverValue = silverGrams * silverPricePerGram * rate;
            
            // Get all cash
            const cashTotal = getInputValue('cashHome') + getInputValue('checking') + getInputValue('savings') + 
                             getInputValue('fixedDeposits') + getInputValue('moneyMarket');
            
            // Get all business assets
            const businessTotal = getInputValue('inventory') + getInputValue('rawMaterials') + 
                                 getInputValue('workInProgress') + getInputValue('receivables') + 
                                 getInputValue('businessCash');
            
            // Get all investments
            const investmentsTotal = getInputValue('stocks') + getInputValue('mutualFunds') + 
                                    getInputValue('sukuk') + getInputValue('reits');
            
            // Get all crypto
            const cryptoTotal = getInputValue('bitcoin') + getInputValue('ethereum') + 
                               getInputValue('stablecoins') + getInputValue('otherCrypto');
            
            // Get receivables
            const receivablesTotal = getInputValue('loansGiven') + getInputValue('wagesOwed') + 
                                    getInputValue('deposits');
            
            // Get retirement
            const retirementTotal = getInputValue('retirement401k') + getInputValue('pension') + 
                                   getInputValue('providentFund');
            
            // Get property income
            const propertyTotal = getInputValue('rentalIncome') + getInputValue('propertyProfits');
            
            // Calculate total assets
            const totalAssets = goldValue + silverValue + cashTotal + businessTotal + investmentsTotal + 
                               cryptoTotal + receivablesTotal + retirementTotal + propertyTotal;
            
            // Get all debts
            const totalDebts = getInputValue('personalLoans') + getInputValue('creditCard') + 
                              getInputValue('businessDebt') + getInputValue('familyDebt') +
                              getInputValue('utilities') + getInputValue('rentOwed') + 
                              getInputValue('taxesOwed') + getInputValue('medical') +
                              getInputValue('employeeWages') + getInputValue('zakatOwed') + 
                              getInputValue('kaffarah');
            
            const netAssets = Math.max(0, totalAssets - totalDebts);
            const zakatAmount = netAssets * 0.025;
            
            const nisabThreshold = 595 * silverPricePerGram * rate;
            
            document.getElementById('totalAssets').textContent = formatCurrency(totalAssets, currency);
            document.getElementById('totalDebts').textContent = formatCurrency(totalDebts, currency);
            document.getElementById('netAssets').textContent = formatCurrency(netAssets, currency);
            document.getElementById('zakatAmount').textContent = formatCurrency(Math.max(0, zakatAmount), currency);
            
            const warningDiv = document.getElementById('thresholdWarning');
            const warningText = document.getElementById('thresholdText');
            
            if (netAssets >= nisabThreshold) {
                warningDiv.className = 'threshold-warning above';
                warningText.textContent = '‚úì Your wealth has reached nisab - Zakat is obligatory';
            } else if (netAssets > 0) {
                warningDiv.className = 'threshold-warning below';
                warningText.textContent = '‚ö† Your wealth is below nisab - Zakat is not obligatory (but sadaqah is encouraged)';
            } else {
                warningDiv.className = 'threshold-warning';
                warningText.textContent = '‚ÑπÔ∏è Enter your assets to calculate zakat';
            }
        }
        
        function showModal(type) {
            // Modal info will be loaded from extensive database
            const modal = document.getElementById('infoModal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');
            
            const modalInfo = getModalInfo(type);
            
            title.textContent = modalInfo.title;
            body.innerHTML = modalInfo.content;
            
            modal.classList.add('active');
        }

        function closeModal() {
            const modal = document.getElementById('infoModal');
            modal.classList.remove('active');
        }

        // Close modal when clicking outside the content area
        document.addEventListener('click', function (event) {
            const modal = document.getElementById('infoModal');
            if (event.target === modal) {
                closeModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
        
function getModalInfo(type) {
    const modalDatabase = {
        // ============ GOLD SECTION ============
        goldJewelry: {
            title: 'Gold Jewelry',
            content: `
                <h4>What to Include:</h4>
                <p>All gold jewelry including necklaces, bracelets, rings, earrings, bangles, and anklets - whether worn regularly or stored.</p>
                
                <h4>Salafi Position:</h4>
                <p>The <strong>majority of Salafi scholars</strong> hold that ALL gold is zakatable, whether worn or stored. This includes jewelry regularly used for permissible adornment. The evidence is general and makes no exceptions.</p>
                
                <div class="daleel">
                    <p>The Prophet Ô∑∫ said: "There is no owner of gold or silver who does not pay what is due on it, but on the Day of Resurrection plates of fire will be prepared for him..." (Sahih Muslim)</p>
                </div>
                
                <h4>How to Determine Weight:</h4>
                <ul>
                    <li>Check jewelry certificates or purchase receipts</li>
                    <li>Use a digital jewelry scale (available online for $10-20)</li>
                    <li>Visit a local jeweler for professional weighing (free service)</li>
                </ul>
                
                <p><strong>Note on Purity:</strong> If your jewelry is not pure gold (e.g., 18K, 22K), convert to pure gold equivalent. 18K is 75% pure, 22K is 91.67% pure.</p>
            `
        },
        
        goldBars: {
            title: 'Gold Coins & Bars',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Gold bullion bars of any size (1g, 1oz, 1kg, etc.)</li>
                    <li>Gold coins (Krugerrands, American Eagles, Canadian Maple Leafs, etc.)</li>
                    <li>Investment-grade gold purchased as wealth storage</li>
                    <li>Gold certificates or ETFs backed by physical gold</li>
                </ul>
                
                <h4>Scholarly Consensus:</h4>
                <p>There is <strong>unanimous agreement (ijma')</strong> that investment gold is fully zakatable. This is clear wealth held as a store of value.</p>
                
                <h4>How to Calculate:</h4>
                <p>Use the total weight in grams of pure gold. For coins with numismatic value above gold content, use the gold weight only, not the collector's premium.</p>
                
                <div class="daleel">
                    <p>"And those who hoard gold and silver and spend it not in the way of Allah - give them tidings of a painful punishment." (Quran 9:34)</p>
                </div>
            `
        },
        
        goldOther: {
            title: 'Other Gold Items',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Gold ornaments and decorative pieces</li>
                    <li>Gold antiques and heirlooms (based on gold weight, not antique value)</li>
                    <li>Gold watches (men: haram to wear, but still zakatable)</li>
                    <li>Gold pens, cufflinks, or other luxury items</li>
                    <li>Broken gold pieces saved</li>
                </ul>
                
                <h4>Salafi Position:</h4>
                <p>All gold has the same ruling for zakat - it doesn't matter if it's jewelry, decoration, or storage. The obligation applies to all gold in your possession.</p>
                
                <p><strong>Important:</strong> Even if an item is haram to use (like gold watches for men or gold utensils), it is still subject to zakat while in your possession. The proper action is to sell such items and use halal alternatives.</p>
            `
        },
        
        // ============ SILVER SECTION ============
        silverJewelry: {
            title: 'Silver Jewelry',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Silver rings (permissible for men, limited to one ring)</li>
                    <li>Silver bracelets and anklets</li>
                    <li>Silver necklaces and chains</li>
                    <li>Any silver ornaments worn or stored</li>
                </ul>
                
                <h4>Ruling:</h4>
                <p>Like gold, ALL silver is subject to zakat. There is no exception for silver jewelry that is worn.</p>
                
                <div class="daleel">
                    <p>Abu Bakr as-Siddiq ÿ±ÿ∂Ÿä ÿßŸÑŸÑŸá ÿπŸÜŸá wrote: "Regarding silver, one-fortieth (2.5%) is due." (Sahih Bukhari)</p>
                </div>
                
                <p><strong>For Men:</strong> A silver ring is permissible, but still zakatable. The ring should not exceed one mithqal (approximately 4.25 grams).</p>
            `
        },
        
        silverBars: {
            title: 'Silver Coins & Bars',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Silver bullion bars of any size</li>
                    <li>Silver coins (American Silver Eagles, Canadian Maple Leafs, etc.)</li>
                    <li>Investment-grade silver</li>
                    <li>Silver ETFs or certificates backed by physical silver</li>
                </ul>
                
                <h4>Nisab Threshold:</h4>
                <p>The nisab for silver is <strong>595 grams</strong> (approximately 21 troy ounces or 19.1 regular ounces).</p>
                
                <h4>Why Use Silver Nisab?</h4>
                <p>Contemporary Salafi scholars recommend using the silver nisab because:</p>
                <ul>
                    <li>It ensures more wealth reaches the poor and needy</li>
                    <li>It better fulfills the maqasid (objectives) of zakat</li>
                    <li>The silver nisab is more universally applicable in modern times</li>
                </ul>
            `
        },
        
        silverUtensils: {
            title: 'Silver Utensils & Decorative Items',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Silver plates, bowls, cups</li>
                    <li>Silver cutlery and serving utensils</li>
                    <li>Silver decorative items and ornaments</li>
                    <li>Silver antiques and collectibles</li>
                </ul>
                
                <h4>‚ö†Ô∏è Important Prohibition:</h4>
                <p>Using gold and silver utensils for eating and drinking is <strong>HARAM</strong> in Islam.</p>
                
                <div class="daleel">
                    <p>The Prophet Ô∑∫ said: "Do not drink from vessels of gold and silver, and do not eat from plates made of them, for they are for them (disbelievers) in this world and for us in the Hereafter." (Sahih Bukhari & Muslim)</p>
                </div>
                
                <p><strong>What You Should Do:</strong> Sell these items and replace them with permissible alternatives. Until sold, calculate their silver weight for zakat.</p>
            `
        },
        
        // ============ CASH & BANKING ============
        cashHome: {
            title: 'Physical Cash at Home',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Cash in your wallet, purse, or pockets</li>
                    <li>Money stored in a safe or lockbox at home</li>
                    <li>Emergency cash reserves</li>
                    <li>Cash gifts not yet deposited</li>
                    <li>All physical currency in your possession</li>
                </ul>
                
                <h4>Multiple Currencies:</h4>
                <p>If you have cash in different currencies (USD, EUR, etc.), convert each to your base currency using the current exchange rate and sum the total.</p>
                
                <h4>Ruling on Paper Money:</h4>
                <p>Paper money (fiat currency) has the same zakat ruling as gold and silver. This is agreed upon by contemporary scholars because it functions as money - a medium of exchange and store of value.</p>
                
                <p><strong>When to Count:</strong> Calculate the amount you have on your zakat date (when one lunar year has passed since your wealth reached nisab).</p>
            `
        },
        
        checking: {
            title: 'Checking/Current Accounts',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>All personal checking accounts</li>
                    <li>Current accounts (UK/Commonwealth term)</li>
                    <li>Transaction accounts</li>
                    <li>Joint accounts (your portion only)</li>
                </ul>
                
                <h4>Fluctuating Balances:</h4>
                <p>If your checking account goes up and down throughout the year:</p>
                <ul>
                    <li>Pay zakat on the balance present on your zakat anniversary date</li>
                    <li>If the balance dropped below nisab during the year and stayed below for extended periods, the hawl (year) may reset</li>
                </ul>
                
                <h4>Joint Accounts:</h4>
                <p>If you share an account with a spouse or family member, only include your share. For example, if you and your spouse equally contribute, include 50% of the balance.</p>
            `
        },
        
        savings: {
            title: 'Savings Accounts',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Personal savings accounts (all of them)</li>
                    <li>High-yield savings accounts</li>
                    <li>Children's savings accounts (if you control them)</li>
                    <li>Emergency fund accounts</li>
                </ul>
                
                <h4>‚ö†Ô∏è CRITICAL ISSUE - Interest (Riba):</h4>
                <p>Interest from conventional savings accounts is <strong>HARAM</strong> and a major sin. You MUST NOT:</p>
                <ul>
                    <li>Keep interest as personal wealth</li>
                    <li>Count it as part of your zakat calculation</li>
                    <li>Give it as zakat (zakat must be from halal wealth)</li>
                    <li>Donate it to mosques or Islamic institutions</li>
                </ul>
                
                <p><strong>What to Do:</strong></p>
                <ol>
                    <li>Calculate zakat ONLY on your principal (the amount you deposited)</li>
                    <li>Immediately remove all interest earned</li>
                    <li>Give interest to poor people directly (not as sadaqah, just to dispose of it)</li>
                    <li>Switch to an Islamic bank or interest-free account</li>
                </ol>
                
                <div class="daleel">
                    <p>"O you who believe! Fear Allah and give up what remains of riba if you are believers." (Quran 2:278)</p>
                </div>
            `
        },
        
        fixedDeposits: {
            title: 'Fixed Deposits / Term Deposits / CDs',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Fixed deposit accounts (any term length)</li>
                    <li>Certificates of Deposit (CDs)</li>
                    <li>Term deposits</li>
                    <li>Time deposits</li>
                </ul>
                
                <h4>Are They Zakatable Even If Locked?</h4>
                <p><strong>YES.</strong> Even if you cannot withdraw the money without penalty until the term ends, this is still your wealth and fully subject to zakat.</p>
                
                <h4>‚ö†Ô∏è Riba Warning:</h4>
                <p>Conventional fixed deposits that pay interest are <strong>engaging in riba</strong>, which is haram. The Salafi position is clear that these are impermissible.</p>
                
                <p><strong>Action Steps:</strong></p>
                <ol>
                    <li>Close these accounts as soon as the term allows</li>
                    <li>Move to Islamic banking (Mudarabah or Wakala accounts)</li>
                    <li>Or invest in halal alternatives (halal stocks, real estate, business)</li>
                    <li>Purify all interest earned - give it away to the poor</li>
                </ol>
                
                <p><strong>For Zakat:</strong> Include only the principal amount (what you deposited), not any interest.</p>
            `
        },
        
        moneyMarket: {
            title: 'Money Market Accounts',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Money market savings accounts</li>
                    <li>Cash management accounts</li>
                    <li>Sweep accounts</li>
                    <li>Similar high-liquidity interest-bearing accounts</li>
                </ul>
                
                <h4>How They Work:</h4>
                <p>Money market accounts are like savings accounts but typically offer higher interest and may have check-writing features. They're more liquid than fixed deposits.</p>
                
                <h4>Zakat Treatment:</h4>
                <p>Include the full principal balance on your zakat date. Same rules apply as savings accounts regarding interest - it must be purified and cannot be counted as zakatable wealth.</p>
                
                <p><strong>Consider:</strong> Moving to Islamic banking alternatives like Mudarabah accounts which operate on profit-sharing, not guaranteed interest.</p>
            `
        },
        
        // ============ BUSINESS ASSETS ============
        inventory: {
            title: 'Inventory for Resale',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>All finished goods ready to sell</li>
                    <li>Products in your store, warehouse, or storage</li>
                    <li>Stock held specifically for trade/resale</li>
                    <li>Merchandise of any kind you intend to sell</li>
                </ul>
                
                <h4>How to Value Inventory:</h4>
                <p>Use the <strong>current wholesale/market value</strong> on your zakat date. This means:</p>
                <ul>
                    <li>NOT the price you paid (could be outdated)</li>
                    <li>NOT the retail price you'll sell it for (too high)</li>
                    <li>Use what you could sell it for in bulk/wholesale TODAY</li>
                </ul>
                
                <div class="daleel">
                    <p>Samurah ibn Jundub ÿ±ÿ∂Ÿä ÿßŸÑŸÑŸá ÿπŸÜŸá reported: "The Messenger of Allah Ô∑∫ used to command us to pay zakat from that which we prepared for sale." (Sunan Abu Dawud)</p>
                </div>
                
                <h4>What NOT to Include:</h4>
                <ul>
                    <li>Business equipment (registers, shelves, computers)</li>
                    <li>The store/warehouse building itself</li>
                    <li>Vehicles used for delivery</li>
                    <li>Display items not for sale</li>
                </ul>
                
                <p><strong>These fixed assets are not zakatable - only goods for trade are.</strong></p>
            `
        },
        
        rawMaterials: {
            title: 'Raw Materials for Manufacturing',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Materials purchased to manufacture products you'll sell</li>
                    <li>Components and parts used in production</li>
                    <li>Supplies that will become finished goods</li>
                    <li>Ingredients used in food production, etc.</li>
                </ul>
                
                <h4>Why Are These Zakatable?</h4>
                <p>Raw materials intended for manufacturing items for sale are part of your "trade goods" (mƒÅl al-tijƒÅrah). They will eventually become products you sell, so they're zakatable.</p>
                
                <h4>Valuation:</h4>
                <p>Use the current replacement cost or market value of these materials on your zakat date.</p>
                
                <h4>Example:</h4>
                <p>If you run a bakery: flour, sugar, eggs bought for making bread/pastries to sell = zakatable. But the oven, mixer, and baking pans = NOT zakatable (fixed assets).</p>
            `
        },
        
        workInProgress: {
            title: 'Work in Progress / Partially Completed Products',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Products currently being manufactured</li>
                    <li>Partially assembled items</li>
                    <li>Goods in production process</li>
                    <li>Items not yet ready for sale but will be sold when complete</li>
                </ul>
                
                <h4>How to Value:</h4>
                <p>There are two approaches:</p>
                <ol>
                    <li><strong>Cost Approach:</strong> Value at the cost incurred so far (materials + labor + overhead used)</li>
                    <li><strong>Market Approach:</strong> Estimate what you could sell the items for in their current state</li>
                </ol>
                
                <p>Use whichever method is more practical for your business. The key principle: these items are destined for sale, making them trade goods subject to zakat.</p>
                
                <h4>Example:</h4>
                <p>Furniture maker with half-finished chairs, or clothing manufacturer with cut fabric not yet sewn - both are work-in-progress and zakatable.</p>
            `
        },
        
        receivables: {
            title: 'Business Accounts Receivable (Strong Debt)',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Unpaid invoices from reliable customers</li>
                    <li>Money owed by creditworthy clients</li>
                    <li>Receivables from customers who acknowledge the debt and will pay</li>
                </ul>
                
                <h4>Strong vs. Weak Debt - Critical Distinction:</h4>
                
                <p><strong>Strong Debt (Dayn Qawiy):</strong></p>
                <ul>
                    <li>Debtor acknowledges the debt</li>
                    <li>Debtor is able to pay (not bankrupt)</li>
                    <li>You can reasonably expect payment</li>
                    <li><strong>Ruling:</strong> You MUST pay zakat on this every year</li>
                </ul>
                
                <p><strong>Weak Debt (Dayn Da'if):</strong></p>
                <ul>
                    <li>Debtor denies owing you</li>
                    <li>Debtor is unable to pay</li>
                    <li>Doubtful if you'll ever collect</li>
                    <li><strong>Ruling:</strong> You may delay zakat until received, or pay annually as precaution</li>
                </ul>
                
                <p><strong>Only include "strong" receivables in this field.</strong> Don't include bad debts unlikely to be recovered.</p>
            `
        },
        
        businessCash: {
            title: 'Business Cash Reserves',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Cash in business checking accounts</li>
                    <li>Business savings and reserve funds</li>
                    <li>Operating cash in the till/register</li>
                    <li>Petty cash</li>
                    <li>Business money market accounts</li>
                </ul>
                
                <h4>Business Structure Matters:</h4>
                
                <p><strong>Sole Proprietorship:</strong> All business cash is YOUR personal wealth. Include 100% in zakat calculation - there's no separation between you and the business.</p>
                
                <p><strong>Partnership:</strong> Include only your ownership share. If you own 50% of the business, include 50% of the cash.</p>
                
                <p><strong>Corporation/LLC:</strong> Scholarly difference exists. Some say the company pays zakat at the business level. Others say you only pay on dividends received. The <strong>safer approach</strong> is to calculate zakat on your ownership share of the business assets.</p>
                
                <p><strong>Recommendation:</strong> Consult a knowledgeable scholar about your specific business structure.</p>
            `
        },
        
        // ============ INVESTMENTS ============
        stocks: {
            title: 'Individual Stocks / Shares',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Shares in publicly traded companies (stock market)</li>
                    <li>Only HALAL companies - must screen for:
                        <ul>
                            <li>No interest-based banking</li>
                            <li>No alcohol, tobacco, pork</li>
                            <li>No gambling, adult entertainment</li>
                            <li>Debt-to-asset ratio below 33%</li>
                            <li>Interest income below 5% of revenue</li>
                        </ul>
                    </li>
                    <li>Private company shares you own</li>
                </ul>
                
                <h4>Valuation - Salafi Position:</h4>
                <p>The <strong>majority of contemporary Salafi scholars</strong> hold that you pay zakat on the <strong>full current market value</strong> of all stocks, whether held for trading or long-term investment.</p>
                
                <h4>Why Full Value?</h4>
                <ul>
                    <li>Stocks are liquid - easily sold for cash</li>
                    <li>They represent real, accessible wealth</li>
                    <li>This better fulfills the rights of the poor</li>
                    <li>It's the more cautious and safer position</li>
                </ul>
                
                <div class="daleel">
                    <p>"Take from their wealth a charity to purify them and sanctify them." (Quran 9:103)</p>
                </div>
                
                <p><strong>Alternative View:</strong> Some scholars say if held long-term (not trading), pay only on dividends received. However, paying on full value is stronger.</p>
            `
        },
        
        mutualFunds: {
            title: 'Mutual Funds / ETFs / Index Funds',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Mutual funds (halal/Islamic funds only)</li>
                    <li>Exchange-Traded Funds (ETFs)</li>
                    <li>Index funds (S&P 500, etc. - if screened for halal)</li>
                    <li>Unit trusts</li>
                </ul>
                
                <h4>Halal Screening Required:</h4>
                <p>Regular mutual funds and ETFs often contain haram stocks. You need:</p>
                <ul>
                    <li>Shariah-compliant funds (AMAGX, HLAL, etc.)</li>
                    <li>Or personally screened index funds using tools like Zoya, Musaffa, or IslamicFinanceGuru</li>
                </ul>
                
                <h4>Zakat Calculation:</h4>
                <p>Pay zakat on the <strong>total current value</strong> of your fund holdings on your zakat date. Check your brokerage statement or fund website for the current market value.</p>
                
                <h4>Important:</h4>
                <p>If your funds contain some haram stocks, you need to:</p>
                <ol>
                    <li>Calculate the haram percentage</li>
                    <li>Purify that portion (give it away)</li>
                    <li>Pay zakat on the remaining halal portion</li>
                    <li>Switch to fully halal funds</li>
                </ol>
            `
        },
        
        sukuk: {
            title: 'Sukuk / Islamic Bonds',
            content: `
                <h4>What Are Sukuk?</h4>
                <p>Sukuk are Shariah-compliant investment certificates. Unlike conventional bonds (which are interest-based loans), sukuk represent ownership in assets or projects and generate returns through profit-sharing or rental income.</p>
                
                <h4>What to Include:</h4>
                <ul>
                    <li>Government sukuk (like Malaysia, Saudi Arabia, etc.)</li>
                    <li>Corporate sukuk from halal companies</li>
                    <li>Sukuk funds or ETFs</li>
                </ul>
                
                <h4>Zakat Treatment:</h4>
                <p>Pay zakat on the <strong>current market value</strong> of your sukuk holdings. If you receive regular distributions from sukuk, those should also be included in your wealth calculation if saved.</p>
                
                <h4>Important Verification:</h4>
                <p>Not all sukuk labeled "Islamic" are truly halal. Some have been criticized by strict scholars for resembling conventional bonds too closely. Research the structure or consult a knowledgeable scholar.</p>
            `
        },
        
        reits: {
            title: 'REITs (Real Estate Investment Trusts)',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Shares in Real Estate Investment Trusts</li>
                    <li>Only halal REITs (no hotels with bars, conventional banks, etc.)</li>
                    <li>Islamic REITs (I-REITs)</li>
                </ul>
                
                <h4>What Are REITs?</h4>
                <p>REITs are companies that own and operate income-producing real estate. By buying REIT shares, you own a small piece of many properties (offices, apartments, warehouses, etc.).</p>
                
                <h4>Halal Considerations:</h4>
                <p>Regular REITs often invest in:</p>
                <ul>
                    <li>Properties with haram uses (casinos, conventional banks, bars)</li>
                    <li>Interest-based mortgages (riba)</li>
                </ul>
                
                <p><strong>Look for:</strong> Islamic REITs (I-REITs) which invest only in halal properties and use Shariah-compliant financing.</p>
                
                <h4>Zakat Calculation:</h4>
                <p>Pay zakat on the current market value of your REIT shares. This is like stocks - value fluctuates daily, use the price on your zakat date.</p>
            `
        },
        
        // ============ CRYPTOCURRENCY ============
        bitcoin: {
            title: 'Bitcoin (BTC)',
            content: `
                <h4>Is Bitcoin Halal?</h4>
                <p>There is ongoing scholarly debate. Some Salafi scholars permit it with conditions, others have reservations due to:</p>
                <ul>
                    <li>Lack of intrinsic value</li>
                    <li>Extreme volatility and speculation</li>
                    <li>Use in haram activities</li>
                    <li>Unclear regulatory status</li>
                </ul>
                
                <p><strong>Those who permit it</strong> treat it like currency or a digital commodity, subject to zakat.</p>
                
                <h4>If You Own Bitcoin:</h4>
                <p>Include the <strong>current value in your base currency</strong> on your zakat date. Check the exchange rate on that specific day.</p>
                
                <h4>Calculation Example:</h4>
                <p>If you own 0.5 BTC and Bitcoin is worth $60,000 on your zakat date:
                <br>0.5 √ó $60,000 = $30,000 (include this amount)</p>
                
                <h4>Important:</h4>
                <p>If you actively trade crypto (buy/sell frequently), this is definitely zakatable as trade goods. If held as investment, the safer opinion is still to pay zakat on full value.</p>
                
                <p><strong>Seek scholarly guidance</strong> on whether crypto is permissible for you to own in the first place.</p>
            `
        },
        
        ethereum: {
            title: 'Ethereum (ETH) & Smart Contract Platforms',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Ethereum (ETH)</li>
                    <li>Similar smart contract platforms</li>
                </ul>
                
                <h4>Shariah Considerations:</h4>
                <p>Ethereum has additional concerns beyond Bitcoin:</p>
                <ul>
                    <li>Used for DeFi (Decentralized Finance) - many DeFi protocols involve riba</li>
                    <li>NFTs on Ethereum often contain haram content</li>
                    <li>Smart contracts may facilitate haram transactions</li>
                </ul>
                
                <p><strong>If you hold ETH:</strong> Ensure you're not participating in:</p>
                <ul>
                    <li>Lending/borrowing with interest (riba)</li>
                    <li>Liquidity pools with interest-bearing tokens</li>
                    <li>Staking that resembles interest-based income</li>
                </ul>
                
                <h4>Zakat Calculation:</h4>
                <p>If permissible to hold, include current market value on your zakat date, just like Bitcoin.</p>
            `
        },
        
        stablecoins: {
            title: 'Stablecoins (USDT, USDC, etc.)',
            content: `
                <h4>What Are Stablecoins?</h4>
                <p>Cryptocurrencies pegged 1:1 to fiat currencies (usually US Dollar). Examples: Tether (USDT), USD Coin (USDC), DAI.</p>
                
                <h4>Shariah Ruling:</h4>
                <p>If the underlying fiat currency (like USD) is permissible to hold, then stablecoins pegged to it are generally treated the same for zakat purposes - like holding cash.</p>
                
                <h4>What to Include:</h4>
                <ul>
                    <li>All stablecoins you hold</li>
                    <li>Value them at face value (1 USDT = $1 USD)</li>
                    <li>Include them in your cash calculation</li>
                </ul>
                
                <h4>Warning About Use:</h4>
                <p>Many people hold stablecoins to:</p>
                <ul>
                    <li>Earn yield through DeFi lending (often riba)</li>
                    <li>Provide liquidity (may involve haram elements)</li>
                </ul>
                
                <p>Ensure your use of stablecoins doesn't involve riba or other prohibited activities.</p>
            `
        },
        
        otherCrypto: {
            title: 'Other Cryptocurrencies / Altcoins',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Any other cryptocurrencies you own (Cardano, Solana, Polygon, etc.)</li>
                    <li>Meme coins (Dogecoin, Shiba Inu, etc.)</li>
                    <li>Utility tokens</li>
                    <li>Governance tokens</li>
                </ul>
                
                <h4>Shariah Concerns:</h4>
                <p>Many altcoins are highly speculative and resemble gambling more than investment. Characteristics to avoid:</p>
                <ul>
                    <li>No real utility or purpose</li>
                    <li>Purely speculative "pump and dump" schemes</li>
                    <li>Meme coins with no value proposition</li>
                    <li>Tokens tied to haram projects</li>
                </ul>
                
                <h4>Zakat Calculation:</h4>
                <p>For any crypto you own (if permissible), include the total current value in your base currency on your zakat date.</p>
                
                <h4>General Crypto Advice:</h4>
                <p>Due to the complex and evolving nature of cryptocurrency, it's strongly recommended to:</p>
                <ol>
                    <li>Consult knowledgeable scholars before investing</li>
                    <li>Avoid projects with questionable utility</li>
                    <li>Stay away from interest-bearing DeFi protocols</li>
                    <li>Be cautious of extreme speculation</li>
                </ol>
            `
        },
        
        // ============ RECEIVABLES / MONEY OWED TO YOU ============
        loansGiven: {
            title: 'Personal Loans Given to Others',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Money you lent to family members (if they will repay)</li>
                    <li>Personal loans to friends (strong likelihood of repayment)</li>
                    <li>Any qard hasan (interest-free loan) you gave</li>
                </ul>
                
                <h4>Strong vs. Weak Debt:</h4>
                
                <p><strong>Strong Debt - INCLUDE HERE:</strong></p>
                <ul>
                    <li>Borrower acknowledges owing you</li>
                    <li>Borrower is able to repay (employed, has assets)</li>
                    <li>You have reasonable expectation of getting your money back</li>
                    <li><strong>Zakat ruling:</strong> You MUST pay zakat annually on this amount</li>
                </ul>
                
                <p><strong>Weak Debt - DO NOT INCLUDE:</strong></p>
                <ul>
                    <li>Borrower denies the loan or disputes the amount</li>
                    <li>Borrower is unable to pay (bankrupt, unemployed long-term)</li>
                    <li>You haven't heard from them in years</li>
                    <li>Doubtful you'll ever see the money again</li>
                    <li><strong>Zakat ruling:</strong> You may wait until you receive it to pay zakat, or pay annually as extra precaution</li>
                </ul>
                
                <div class="daleel">
                    <p>Ali ibn Abi Talib ÿ±ÿ∂Ÿä ÿßŸÑŸÑŸá ÿπŸÜŸá said regarding zakat on debt: "There is zakat on debt that is acknowledged and the debtor is solvent." (Musannaf Abd al-Razzaq)</p>
                </div>
            `
        },
        
        wagesOwed: {
            title: 'Unpaid Salary / Wages Owed to You',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Salary earned but not yet paid by your employer</li>
                    <li>Wages for work completed but payment pending</li>
                    <li>Commissions owed to you</li>
                    <li>Bonuses you've earned but haven't received</li>
                </ul>
                
                <h4>When to Include:</h4>
                <p>Only include if:</p>
                <ul>
                    <li>You've already earned it (worked the hours, completed the project)</li>
                    <li>Your employer is reliable and will definitely pay</li>
                    <li>Payment is just delayed (end of month, next pay period)</li>
                </ul>
                
                <h4>Do NOT Include:</h4>
                <ul>
                    <li>Future salary you haven't earned yet</li>
                    <li>Potential bonuses that aren't guaranteed</li>
                    <li>Wages from an employer who may not pay (bankrupt company)</li>
                </ul>
                
                <h4>Example:</h4>
                <p>Your zakat date is June 15th. You worked June 1-15 but won't get paid until June 30th. This is <strong>earned wages</strong> from a reliable employer, so INCLUDE it.</p>
                
                <p>But your July salary (for work not yet done) = do NOT include.</p>
            `
        },
        
        deposits: {
            title: 'Security Deposits (Recoverable)',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Rental deposits you paid (will get back when lease ends)</li>
                    <li>Utility deposits (electric, water, gas companies)</li>
                    <li>Security deposits for services</li>
                    <li>Collateral deposits that will be returned</li>
                </ul>
                
                <h4>Why Are These Zakatable?</h4>
                <p>Security deposits are your money held temporarily by someone else. You will get them back, so they're part of your wealth - specifically, they're "strong debt" owed to you.</p>
                
                <h4>When to Include:</h4>
                <ul>
                    <li>You have reasonable expectation of getting them back</li>
                    <li>The landlord/company is reliable</li>
                    <li>No major dispute about the deposit</li>
                </ul>
                
                <h4>Do NOT Include:</h4>
                <ul>
                    <li>Deposits you know will be kept (damaged apartment, breached contract)</li>
                    <li>Deposits from unreliable parties who disappeared</li>
                </ul>
                
                <h4>Example:</h4>
                <p>You paid a $2,000 security deposit when renting your apartment. This is zakatable every year until you move out and receive it back. Once returned, it remains in your wealth and continues to be zakatable.</p>
            `
        },
        
        // ============ RETIREMENT FUNDS ============
        retirement401k: {
            title: '401(k) / IRA / Retirement Accounts',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>401(k) accounts (traditional and Roth)</li>
                    <li>IRA accounts (Individual Retirement Accounts)</li>
                    <li>403(b) for non-profit employees</li>
                    <li>TSP (Thrift Savings Plan) for government workers</li>
                </ul>
                
                <h4>Salafi Scholarly Difference:</h4>
                <p>This is a contemporary issue with two main views:</p>
                
                <p><strong>View 1 - Pay Zakat Annually (Stronger):</strong></p>
                <ul>
                    <li>These accounts are legally YOUR money</li>
                    <li>You CAN access them (even with penalties)</li>
                    <li>The growth/value is in your name</li>
                    <li>Being restricted doesn't remove ownership</li>
                    <li><strong>Ruling:</strong> Pay zakat every year on the full balance</li>
                </ul>
                
                <p><strong>View 2 - Delay Until Withdrawal:</strong></p>
                <ul>
                    <li>Money is locked and not "in hand"</li>
                    <li>Early withdrawal has severe penalties</li>
                    <li>Similar to "weak debt" - not fully accessible</li>
                    <li><strong>Ruling:</strong> Pay accumulated zakat when you withdraw/retire</li>
                </ul>
                
                <h4>Recommendation:</h4>
                <p>The <strong>more cautious approach</strong> is to pay zakat annually on the accessible portion. This ensures the rights of the poor and is the safer position.</p>
                
                <h4>‚ö†Ô∏è Interest/Haram Investments:</h4>
                <p>Many 401(k)s invest in:</p>
                <ul>
                    <li>Interest-based bonds (haram)</li>
                    <li>Stocks of haram companies</li>
                    <li>Index funds with mixed holdings</li>
                </ul>
                
                <p><strong>Action needed:</strong></p>
                <ol>
                    <li>Check if your plan offers halal options (some have Islamic funds)</li>
                    <li>Choose the most halal available options (stocks over bonds)</li>
                    <li>Calculate haram percentage and purify it</li>
                    <li>Consider self-directed IRA for more control</li>
                </ol>
            `
        },
        
        pension: {
            title: 'Pension Funds (Vested Benefits)',
            content: `
                <h4>What Are Vested Pension Benefits?</h4>
                <p>"Vested" means you have earned the right to receive pension money, even if you leave the company today. The money is yours, though you can't access it until retirement age.</p>
                
                <h4>What to Include:</h4>
                <ul>
                    <li>Vested portion of your pension</li>
                    <li>Only if you have some control or ability to access</li>
                    <li>Defined contribution pensions where you can see the balance</li>
                </ul>
                
                <h4>Different Types of Pensions:</h4>
                
                <p><strong>Defined Contribution (like 401k):</strong></p>
                <ul>
                    <li>You have an account balance you can see</li>
                    <li>The money is invested and grows</li>
                    <li>Vested amount is zakatable (use View 1 or View 2 above)</li>
                </ul>
                
                <p><strong>Defined Benefit (traditional pension):</strong></p>
                <ul>
                    <li>No account balance - just a promise of future payments</li>
                    <li>You'll get $X per month when you retire</li>
                    <li>Scholarly difference: some say no zakat until you receive payments, others say estimate present value</li>
                    <li><strong>Practical approach:</strong> Pay zakat when you start receiving monthly pension checks</li>
                </ul>
                
                <h4>If Unsure:</h4>
                <p>Consult a scholar familiar with your specific pension structure. The safer approach is to pay zakat on accessible amounts.</p>
            `
        },
        
        providentFund: {
            title: 'Provident Fund (EPF, CPF, etc.)',
            content: `
                <h4>What Are Provident Funds?</h4>
                <p>Government-mandated retirement savings common in Malaysia (EPF), Singapore (CPF), India (PF), and other countries. Both employer and employee contribute.</p>
                
                <h4>What to Include:</h4>
                <ul>
                    <li>Your current provident fund balance</li>
                    <li>Both your contributions and employer contributions</li>
                    <li>All growth/dividends earned</li>
                </ul>
                
                <h4>Are They Zakatable?</h4>
                <p><strong>YES</strong> - according to the stronger opinion. Reasons:</p>
                <ul>
                    <li>This is YOUR money in YOUR account</li>
                    <li>You can often withdraw for certain purposes (housing, medical, etc.)</li>
                    <li>It's accessible wealth, even if restricted</li>
                    <li>The account statement shows it as your balance</li>
                </ul>
                
                <h4>Scholarly Positions:</h4>
                
                <p><strong>Majority View:</strong> Pay zakat annually on the full balance. This is the safer, more cautious approach.</p>
                
                <p><strong>Alternative View:</strong> Since it's locked until retirement, delay zakat until withdrawal. Then pay accumulated zakat.</p>
                
                <h4>Dividends/Returns:</h4>
                <p>Provident funds earn returns through investments. If these investments include riba or haram stocks:</p>
                <ol>
                    <li>You typically cannot control the investment choices</li>
                    <li>Some scholars say this is excused due to necessity</li>
                    <li>The safer approach: calculate haram percentage and purify it</li>
                    <li>Pay zakat only on the halal portion</li>
                </ol>
            `
        },
        
        // ============ RENTAL INCOME & PROPERTY ============
        rentalIncome: {
            title: 'Rental Income Received & Saved',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Rental income you've RECEIVED this year</li>
                    <li>That you've SAVED (not spent on living expenses)</li>
                    <li>From properties you rent out</li>
                </ul>
                
                <h4>Important Distinction:</h4>
                
                <p><strong>The Property Itself:</strong> Your rental property (house, apartment, commercial building) is <strong>NOT zakatable</strong>. It's a fixed asset, like business equipment.</p>
                
                <p><strong>The Rental Income:</strong> Money you collect from tenants <strong>IS zakatable</strong> IF:</p>
                <ol>
                    <li>You've received it (not future rent)</li>
                    <li>You've saved it (not immediately spent)</li>
                    <li>It's been in your possession for one lunar year</li>
                </ol>
                
                <h4>How It Works:</h4>
                
                <p><strong>Example:</strong> You own a rental house worth $300,000. You collect $2,000/month rent.</p>
                <ul>
                    <li>The $300,000 house = NOT zakatable</li>
                    <li>The $2,000/month you collect and save = IS zakatable</li>
                </ul>
                
                <p>If you immediately spend the rent on your mortgage, bills, or living expenses, there's no zakat on it (you don't have it). But if you save $10,000 of rental income over the year, that $10,000 is zakatable when it reaches its hawl.</p>
                
                <div class="daleel">
                    <p>The general principle: "There is no zakat on a dwelling or a servant." (Sunan ad-Daraqutni) - meaning properties themselves are not zakatable, only the income if saved.</p>
                </div>
            `
        },
        
        propertyProfits: {
            title: 'Property Sale Profits (Saved)',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Profit from selling investment properties</li>
                    <li>Only if the money is SAVED</li>
                    <li>Applies to properties held for investment/resale</li>
                </ul>
                
                <h4>Different Types of Property Sales:</h4>
                
                <p><strong>1. Personal Residence:</strong></p>
                <ul>
                    <li>You lived in the house/apartment</li>
                    <li>You sold it to buy another residence or downsize</li>
                    <li><strong>Zakat:</strong> Generally NO zakat on the property itself, but YES on profit if saved</li>
                </ul>
                
                <p><strong>2. Investment Property (Held for Rental):</strong></p>
                <ul>
                    <li>You bought it to rent out, then later sold it</li>
                    <li>The property itself was not zakatable while you owned it</li>
                    <li><strong>Zakat:</strong> YES on the sale profit if you save it</li>
                </ul>
                
                <p><strong>3. Property Held for Trading/Resale:</strong></p>
                <ul>
                    <li>You bought it specifically to flip/resell for profit</li>
                    <li>Like inventory for a real estate business</li>
                    <li><strong>Zakat:</strong> The property itself was zakatable while you owned it, AND the profit when sold</li>
                </ul>
                
                <h4>When to Pay Zakat:</h4>
                <p>If you sell a property and save the profit, that money becomes part of your zakatable wealth. Calculate it when its hawl (lunar year) is complete.</p>
                
                <h4>If Profit Was Immediately Spent:</h4>
                <p>If you used the sale proceeds to buy another house, pay debts, or living expenses, and nothing remains on your zakat date, there's no zakat on that money.</p>
            `
        },
        
        // ============ DEBTS - IMMEDIATE ============
        personalLoans: {
            title: 'Personal Loans Due Immediately',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Personal loans that are DUE NOW or very soon</li>
                    <li>Short-term loans from family/friends</li>
                    <li>Payday loans (haram, but if you have them)</li>
                    <li>Any debt you must repay immediately</li>
                </ul>
                
                <h4>Deductibility of Debts - Salafi Position:</h4>
                
                <p><strong>Immediate Debts (Include Here):</strong></p>
                <ul>
                    <li>Debts due right now</li>
                    <li>Debts you could be sued for today</li>
                    <li>Obligations that must be paid immediately</li>
                    <li><strong>Deductible from zakat calculation</strong></li>
                </ul>
                
                <p><strong>Long-term Debts (DO NOT Include Here):</strong></p>
                <ul>
                    <li>Mortgages (payments spread over 15-30 years)</li>
                    <li>Car loans (payments over 3-7 years)</li>
                    <li>Student loans with future payment dates</li>
                    <li><strong>Generally NOT deductible</strong> according to stronger Salafi position</li>
                </ul>
                
                <h4>Why Aren't Long-term Debts Deductible?</h4>
                <p>The stronger Salafi opinion:</p>
                <ul>
                    <li>Zakat is on wealth you currently possess</li>
                    <li>Future payments aren't due yet</li>
                    <li>You're using the asset (house, car) right now</li>
                    <li>Only the current month's payment could be deducted</li>
                </ul>
                
                <div class="daleel">
                    <p>Ibn Hazm stated: "There is no difference among people regarding one who has wealth reaching nisab and owes debt due after a year or two or more, that zakat is obligatory on him." (Al-Muhalla)</p>
                </div>
                
                <h4>Example:</h4>
                <p>You have a $200,000 mortgage, but only owe THIS month's $1,500 payment. Include the $1,500, not the full $200,000.</p>
            `
        },
        
        creditCard: {
            title: 'Credit Card Balance (Current Statement)',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Current credit card balance (what you owe right now)</li>
                    <li>Only the statement balance, not the total credit limit</li>
                    <li>All credit cards combined</li>
                </ul>
                
                <h4>‚ö†Ô∏è Credit Cards and Riba:</h4>
                <p><strong>Important Islamic ruling:</strong> Credit cards that charge interest are problematic in Islam. Using them falls into two categories:</p>
                
                <p><strong>1. Paying in Full Every Month (No Interest):</strong></p>
                <ul>
                    <li>More permissible according to many scholars</li>
                    <li>You never pay interest</li>
                    <li>Using it as a short-term convenience</li>
                    <li>Still has conditions (avoid late fees, etc.)</li>
                </ul>
                
                <p><strong>2. Carrying a Balance (Paying Interest):</strong></p>
                <ul>
                    <li>Clearly involves riba (interest)</li>
                    <li>Haram according to all scholars</li>
                    <li>Must stop this practice immediately</li>
                </ul>
                
                <h4>For Zakat Purposes:</h4>
                <p>Your credit card balance (amount you owe) is an immediate debt. Include it to reduce your zakatable wealth.</p>
                
                <h4>What You Should Do:</h4>
                <ol>
                    <li>Pay off credit card debt as soon as possible</li>
                    <li>Never carry a balance that accrues interest</li>
                    <li>Consider Islamic banking alternatives (some offer debit cards with rewards)</li>
                    <li>Use debit cards or cash instead</li>
                </ol>
            `
        },
        
        businessDebt: {
            title: 'Business Debts (Due Immediately)',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Supplier invoices due now</li>
                    <li>Business loan payments due this month</li>
                    <li>Business credit card balances</li>
                    <li>Immediate business obligations</li>
                </ul>
                
                <h4>For Business Owners:</h4>
                <p>If you're a sole proprietor, your business debts are your personal debts. They directly reduce your zakatable wealth.</p>
                
                <p>If your business is a separate entity (LLC, corporation), the treatment is more complex. Generally:</p>
                <ul>
                    <li>Business debts stay with the business</li>
                    <li>You pay zakat on your personal ownership share of net business assets</li>
                    <li>Consult a scholar for your specific structure</li>
                </ul>
                
                <h4>What NOT to Include:</h4>
                <ul>
                    <li>Long-term business loans (include only this month's payment)</li>
                    <li>Future supplier invoices not yet due</li>
                    <li>Projected expenses</li>
                </ul>
                
                <h4>Example:</h4>
                <p>You own a store. You owe:</p>
                <ul>
                    <li>$5,000 to suppliers (due in 10 days) - <strong>INCLUDE</strong></li>
                    <li>$500 monthly payment on equipment loan - <strong>INCLUDE</strong></li>
                    <li>$50,000 total remaining on that loan - <strong>Do NOT include</strong></li>
                </ul>
            `
        },
        
        familyDebt: {
            title: 'Money Borrowed from Family/Friends',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Money you borrowed from relatives</li>
                    <li>Loans from friends</li>
                    <li>Informal debts (even without written agreement)</li>
                </ul>
                
                <h4>Why Include This?</h4>
                <p>Even informal debts are real obligations in Islam. If someone lent you money and expects it back, this is a debt upon you.</p>
                
                <div class="daleel">
                    <p>The Prophet Ô∑∫ said: "Delay in paying debts by a wealthy person is injustice." (Sahih Bukhari & Muslim)</p>
                </div>
                
                <h4>Include If:</h4>
                <ul>
                    <li>The lender expects repayment</li>
                    <li>There was an understanding you would pay it back</li>
                    <li>It's a genuine loan, not a gift</li>
                </ul>
                
                <h4>Do NOT Include If:</h4>
                <ul>
                    <li>It was a gift, not a loan</li>
                    <li>The person explicitly forgave the debt</li>
                    <li>It was clearly not intended to be repaid</li>
                </ul>
                
                <h4>Important:</h4>
                <p>Family loans should be interest-free (qard hasan). If a family member is charging you interest, this involves riba and is haram. The debt is still a debt, but the interest portion is unlawful and must be addressed.</p>
                
                <h4>Only Include Immediate Debts:</h4>
                <p>If you borrowed money years ago with no set repayment date, only include it if you could be asked to repay it right now. Long-term informal loans where repayment is "whenever you can" are treated differently by some scholars.</p>
            `
        },
        
        // ============ DEBTS - BILLS & OBLIGATIONS ============
        utilities: {
            title: 'Unpaid Utility Bills',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Overdue electricity bills</li>
                    <li>Unpaid water bills</li>
                    <li>Gas bills not yet paid</li>
                    <li>Internet/phone bills due</li>
                    <li>Any utility payment you're late on</li>
                </ul>
                
                <h4>Current vs. Future Bills:</h4>
                
                <p><strong>Include (Deductible):</strong></p>
                <ul>
                    <li>This month's bill that's due</li>
                    <li>Overdue bills from past months</li>
                    <li>Bills you must pay right now</li>
                </ul>
                
                <p><strong>Do NOT Include:</strong></p>
                <ul>
                    <li>Next month's bill (not due yet)</li>
                    <li>Estimated future usage</li>
                    <li>Annual estimates of utility costs</li>
                </ul>
                
                <h4>Example:</h4>
                <p>Today is June 15th (your zakat date):</p>
                <ul>
                    <li>May electricity bill ($150) - still unpaid - <strong>INCLUDE</strong></li>
                    <li>June electricity bill ($140) - just received, due June 30 - <strong>INCLUDE</strong></li>
                    <li>July electricity bill - not received yet - <strong>Do NOT include</strong></li>
                </ul>
                
                <h4>Why This Matters:</h4>
                <p>Only debts that are currently due reduce your zakatable wealth. Future obligations, even if certain, are not deductible.</p>
            `
        },
        
        rentOwed: {
            title: 'Unpaid Rent (Current Month Only)',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>This month's rent if not yet paid</li>
                    <li>Overdue rent from previous months</li>
                </ul>
                
                <h4>Do NOT Include:</h4>
                <ul>
                    <li>Future months' rent (not due yet)</li>
                    <li>The entire year's rent in advance</li>
                </ul>
                
                <h4>Example:</h4>
                <p>Your rent is $1,500/month, paid on the 1st of each month. Your zakat date is January 15th:</p>
                <ul>
                    <li>January rent ($1,500) - already paid on Jan 1st - <strong>Do NOT include</strong> (not a debt anymore)</li>
                    <li>February rent - not due until Feb 1st - <strong>Do NOT include</strong></li>
                </ul>
                
                <p>But if your zakat date is January 31st and you haven't paid January rent yet:</p>
                <ul>
                    <li>January rent ($1,500) - due yesterday! - <strong>INCLUDE</strong></li>
                </ul>
                
                <h4>Principle:</h4>
                <p>Only include rent that is currently owed. Zakat is calculated on your current financial state, not future obligations.</p>
            `
        },
        
        taxesOwed: {
            title: 'Taxes Currently Due',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Income tax owed (if filed but not paid)</li>
                    <li>Property tax currently due</li>
                    <li>Sales tax collected but not remitted (for business owners)</li>
                    <li>Any tax obligation you must pay now</li>
                </ul>
                
                <h4>Timing Matters:</h4>
                
                <p><strong>Include:</strong></p>
                <ul>
                    <li>Tax bill received and due</li>
                    <li>Taxes you know you owe (even if not billed yet)</li>
                    <li>Overdue taxes from prior years</li>
                </ul>
                
                <p><strong>Do NOT Include:</strong></p>
                <ul>
                    <li>Estimated taxes for next year</li>
                    <li>Taxes that will be owed in the future but aren't calculated yet</li>
                </ul>
                
                <h4>Scholarly Discussion on Taxes:</h4>
                <p>There is difference of opinion on whether government taxes reduce zakatable wealth:</p>
                
                <p><strong>View 1:</strong> Taxes are owed to the government, so they're a debt and deductible</p>
                <p><strong>View 2:</strong> Taxes and zakat serve different purposes, so taxes don't reduce zakat obligation</p>
                
                <p>The common practical position is that <strong>currently due taxes can be deducted</strong> as they are obligations you must fulfill.</p>
            `
        },
        
        medical: {
            title: 'Unpaid Medical Bills',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Hospital bills not yet paid</li>
                    <li>Doctor visit charges owed</li>
                    <li>Prescription costs not paid</li>
                    <li>Medical procedures you're paying off</li>
                </ul>
                
                <h4>Payment Plans:</h4>
                <p>If you have medical debt on a payment plan:</p>
                <ul>
                    <li><strong>Include:</strong> Payments due this month or overdue</li>
                    <li><strong>Do NOT include:</strong> Future payments not yet due</li>
                </ul>
                
                <h4>Example:</h4>
                <p>You had surgery costing $10,000. You're paying $500/month for 20 months. On your zakat date:</p>
                <ul>
                    <li>This month's $500 payment (due or overdue) - <strong>INCLUDE</strong></li>
                    <li>The remaining $9,500 (19 future payments) - <strong>Do NOT include</strong></li>
                </ul>
                
                <h4>Insurance:</h4>
                <p>Do NOT include:</p>
                <ul>
                    <li>Amounts that insurance will cover</li>
                    <li>Pending insurance claims</li>
                </ul>
                
                <p>Only include the portion you must actually pay out-of-pocket.</p>
            `
        },
        
        // ============ DEBTS - WAGES & RELIGIOUS OBLIGATIONS ============
        employeeWages: {
            title: 'Wages Owed to Employees',
            content: `
                <h4>For Business Owners Only:</h4>
                <p>If you employ others and owe them wages/salary:</p>
                
                <h4>What to Include:</h4>
                <ul>
                    <li>Current pay period wages not yet paid</li>
                    <li>Overdue wages you owe workers</li>
                    <li>Bonuses earned but not distributed</li>
                    <li>Commission owed to salespeople</li>
                </ul>
                
                <h4>Do NOT Include:</h4>
                <ul>
                    <li>Future pay periods (work not done yet)</li>
                    <li>Potential future bonuses not earned</li>
                </ul>
                
                <h4>Extremely Important:</h4>
                <p>Delaying payment of workers' wages is a MAJOR SIN in Islam.</p>
                
                <div class="daleel">
                    <p>The Prophet Ô∑∫ said: "Give the worker his wages before his sweat dries." (Ibn Majah - Hasan)</p>
                    <p>The Prophet Ô∑∫ also said: "Allah said: 'I will be an opponent to three persons on the Day of Resurrection... and a man who hires a worker and gets the full work done by him but does not pay him his wages.'" (Sahih Bukhari)</p>
                </div>
                
                <h4>Priority:</h4>
                <p>If you owe employees wages, paying them takes priority over many other expenses. This is a serious obligation.</p>
                
                <h4>For Employees:</h4>
                <p>If YOU are owed wages (you're the employee), that goes in "Wages Owed to You" in the Receivables section, not here.</p>
            `
        },
        
        zakatOwed: {
            title: 'Unpaid Zakat from Previous Years',
            content: `
                <h4>What to Include:</h4>
                <ul>
                    <li>Zakat you calculated but didn't pay</li>
                    <li>Previous years' zakat still owed</li>
                    <li>Zakat you delayed paying</li>
                </ul>
                
                <h4>Critical Ruling:</h4>
                <p>Zakat is a DEBT you owe to Allah, and through Him, to the poor. It does not expire or get forgiven just because time passed.</p>
                
                <p>If you owe zakat from past years:</p>
                <ol>
                    <li>You MUST still pay it (this is a debt upon you)</li>
                    <li>It should be paid ASAP, not delayed further</li>
                    <li>You can deduct it from this year's calculation (it's a debt)</li>
                    <li>But this doesn't excuse you from paying it!</li>
                </ol>
                
                <div class="daleel">
                    <p>"And establish prayer and give zakah, and whatever good you put forward for yourselves - you will find it with Allah." (Quran 2:110)</p>
                </div>
                
                <h4>How to Calculate Old Zakat:</h4>
                <p>If you never calculated it before:</p>
                <ul>
                    <li>Try to estimate your wealth in those past years</li>
                    <li>Calculate 2.5% for each year</li>
                    <li>If you can't determine exactly, estimate generously</li>
                    <li>Pay it as soon as possible</li>
                </ul>
                
                <h4>Repentance:</h4>
                <p>If you deliberately delayed zakat (without valid excuse like not knowing it was obligatory), you should:</p>
                <ol>
                    <li>Repent sincerely to Allah</li>
                    <li>Pay all missed zakat immediately</li>
                    <li>Ensure you pay on time going forward</li>
                </ol>
            `
        },
        
        kaffarah: {
            title: 'Kaffarah / Fidyah Owed',
            content: `
                <h4>What Are These?</h4>
                
                <p><strong>Kaffarah (Expiation):</strong> Penalty for certain sins or broken obligations:</p>
                <ul>
                    <li>Breaking an oath/vow (kaffarah al-yamin)</li>
                    <li>Breaking fast intentionally in Ramadan (kaffarah al-saum)</li>
                    <li>Zihar (certain harmful statements in marriage)</li>
                    <li>Killing someone by mistake (kaffarah al-qatl)</li>
                </ul>
                
                <p><strong>Fidyah:</strong> Compensation for missed fasts when unable to fast:</p>
                <ul>
                    <li>Chronically ill person who can't fast</li>
                    <li>Elderly person unable to fast</li>
                    <li>Pregnant/nursing women who missed fasts (scholarly difference)</li>
                </ul>
                
                <h4>What to Include Here:</h4>
                <ul>
                    <li>Kaffarah you owe but haven't fulfilled</li>
                    <li>Fidyah for missed fasts you haven't paid</li>
                    <li>Any other religious financial obligation owed</li>
                </ul>
                
                <h4>Amounts:</h4>
                <p>Kaffarah and Fidyah have specific amounts set by scholars:</p>
                <ul>
                    <li>Usually feeding 10 or 60 poor people (depends on the violation)</li>
                    <li>Or fasting 2 consecutive months (for some kaffarah)</li>
                    <li>Fidyah: feeding one poor person per missed fast</li>
                </ul>
                
                <p>Calculate the monetary value based on your local costs to feed poor people.</p>
                
                <h4>Important:</h4>
                <p>These are SERIOUS obligations that must be fulfilled. They should be paid as soon as possible, not delayed. Including them in your debts reduces your zakatable wealth, but you must still actually pay them.</p>
            `
        }
    };
    
    return modalDatabase[type] || {
        title: 'Information',
        content: '<p>Detailed information for this field. Please consult with a qualified Islamic scholar for specific rulings about your situation.</p>'
    };
}

        function resetForm() {
            document.querySelectorAll('.calc-input').forEach((input) => {
                input.value = '';
            });
            calculateZakat();
        }

        function exportToPDF() {
            if (!window.jspdf || !window.jspdf.jsPDF) {
                alert('PDF export is unavailable right now. Please refresh and try again.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const currency = document.getElementById('currency').value;

            const totalAssets = document.getElementById('totalAssets').textContent;
            const totalDebts = document.getElementById('totalDebts').textContent;
            const netAssets = document.getElementById('netAssets').textContent;
            const zakatAmount = document.getElementById('zakatAmount').textContent;
            const goldNisab = document.getElementById('goldNisab').textContent;
            const silverNisab = document.getElementById('silverNisab').textContent;

            doc.setFontSize(18);
            doc.text('Zakat Calculator Summary', 14, 20);
            doc.setFontSize(11);
            doc.text('Generated: ' + new Date().toLocaleString(), 14, 28);
            doc.text('Currency: ' + currency, 14, 35);

            doc.setFontSize(13);
            doc.text('Nisab', 14, 48);
            doc.setFontSize(11);
            doc.text('Gold (85g): ' + goldNisab, 14, 56);
            doc.text('Silver (595g): ' + silverNisab, 14, 63);

            doc.setFontSize(13);
            doc.text('Calculation', 14, 76);
            doc.setFontSize(11);
            doc.text('Total Assets: ' + totalAssets, 14, 84);
            doc.text('Total Debts: ' + totalDebts, 14, 91);
            doc.text('Net Zakatable Assets: ' + netAssets, 14, 98);
            doc.text('Zakat Due (2.5%): ' + zakatAmount, 14, 105);

            doc.save('zakat-summary.pdf');
        }

        function setupCalculator() {
            // Recalculate as users type in any monetary/weight field
            document.querySelectorAll('.calc-input').forEach((input) => {
                input.addEventListener('input', calculateZakat);
                input.addEventListener('change', calculateZakat);
            });

            // Recompute thresholds and totals when currency changes
            const currencySelect = document.getElementById('currency');
            if (currencySelect) {
                currencySelect.addEventListener('change', updateNisab);
            }

            // Run once immediately with default/cached values
            calculateZakat();
        }

        document.addEventListener('DOMContentLoaded', function () {
            setupCalculator();
            initializeData();
        });
</script>
